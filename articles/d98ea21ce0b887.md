---
title: "JSDOMを使ったIntegration Testが時代遅れかも知れないので調べてみた"
emoji: "🐕"
type: "tech" # tech: 技術記事 / idea: アイデア
topics: []
published: false
---

**ネタ元の記事 "Why I Won’t Use JSDOM"**
https://www.epicweb.dev/why-i-won-t-use-jsdom


## 記事の主張

**メインの批判点：**
1. **JSDOMの根本的問題**: Node.jsで動作し、ブラウザのふりをするが、結果的にどちらでもない中途半端な存在
2. **技術的制限**:
   - 標準ではないイベントを生成し、環境間で一貫性がない
   - グローバルAPIを問題のある方法でパッチする
   - ブラウザのエクスポート条件を強制することで依存関係を不適切に解決

**テスト哲学の問題**:
「テスト環境が実際のコード実行環境に近いほど、テストの価値が高まる」という考えに基づき、JSDOMは実ブラウザ環境から離れすぎている

**推奨される代替案**:
- **Vitest Browser Mode**: 実際のブラウザでテストを直接実行
- Playwrightをブラウザプロバイダーとして使用可能
- より信頼性の高いコンポーネントテストを提供

**結論**: ポリフィルの時代から脱却し、ブラウザ向けコードを実際のブラウザでテストする「パラダイムシフト」を提唱

## 調べる前の仮説

JSDOM自体はまだ非推奨ではないが、Vitest Browser Mode や Playwright Component Test などの実ブラウザを用いたテストが普及したので、それぞれ使い分けることが重要。軽量高速が効果的なユニットテストなどではVitest + JSDOMで高速に。よりユーザー目線の統合テストは Vitest Browser Mode などを用いて実DOMでテストを行う。のが良いのではないだろうか？

まずは主張と実体を調べ、その課題を解決するツールが育っているのか、その課題感は目的に対して妥当なのか？を調べる必要がある。

※仮説を持つことで、成功でも失敗でも、確実に自分の学習を高めることが出来るため、調査前段階の手持ちの知識で当たりをつけておいています。


## 調査中の疑問と解決リスト

- なぜフロントエンドテストにはJSDOMが用いられたのか？
  - ブラウザを起動するコストを掛けずに軽量高速にユーザーイベントを模倣したテストを実現したかったから
- なぜ記事では「JSDOMを使わない」と主張しているのか？
  - JSDOMは、node.jsで実行され、ブラウザのふりをするが、結局どちらでも無いから
- "Vitest Browser Mode" や "Playwright Component Test" は、E2EやJSDOMの統合テストと比べて実行コスト（速さ）はどう違うのか？
  - a
- JSDOM + Vitest + Testing Library React からの置き換えコストは？
- すべて置き換えで良いのか？まだJSDOMが有効なパターンは無いのか？
