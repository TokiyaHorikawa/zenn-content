---
title: "JSDOMを使ったIntegration Testが時代遅れかも知れないので調べてみた"
emoji: "🐕"
type: "tech" # tech: 技術記事 / idea: アイデア
topics: []
published: false
publication_name: globis
---

**ネタ元の記事 "Why I Won’t Use JSDOM"**
https://www.epicweb.dev/why-i-won-t-use-jsdom


## ネタ元記事の主張

**メインの批判点：**
1. **JSDOMの根本的問題**: Node.jsで動作し、ブラウザのふりをするが、結果的にどちらでもない中途半端な存在
2. **技術的制限**:
   - 標準ではないイベントを生成し、環境間で一貫性がない
   - グローバルAPIを問題のある方法でパッチする
   - ブラウザのエクスポート条件を強制することで依存関係を不適切に解決

**テスト哲学の問題**:
「テスト環境が実際のコード実行環境に近いほど、テストの価値が高まる」という考えに基づき、JSDOMは実ブラウザ環境から離れすぎている

**推奨される代替案**:
- **Vitest Browser Mode**: 実際のブラウザでテストを直接実行
- Playwrightをブラウザプロバイダーとして使用可能
- より信頼性の高いコンポーネントテストを提供

**結論**: ポリフィルの時代から脱却し、ブラウザ向けコードを実際のブラウザでテストする「パラダイムシフト」を提唱

## 調べる前の仮説

JSDOM自体はまだ非推奨ではないが、Vitest Browser Mode や Playwright Component Test などの実ブラウザを用いたテストが普及したので、それぞれ使い分けることが重要。軽量高速が効果的なユニットテストなどではVitest + JSDOMで高速に。よりユーザー目線の統合テストは Vitest Browser Mode などを用いて実DOMでテストを行う。のが良いのではないだろうか？

まずは主張と実体を調べ、その課題を解決するツールが育っているのか、その課題感は目的に対して妥当なのか？を調べる必要がある。

※仮説を持つことで、成功でも失敗でも、確実に自分の学習を高めることが出来るため、調査前段階の手持ちの知識で当たりをつけておいています。


## 調査中の疑問と解決リスト（執筆中メモ）

- なぜフロントエンドテストにはJSDOMが用いられたのか？
  - ブラウザを起動するコストを掛けずに軽量高速にユーザーイベントを模倣したテストを実現したかったから
- なぜ記事では「JSDOMを使わない」と主張しているのか？
  - JSDOMは、node.jsで実行され、ブラウザのふりをするが、結局どちらでも無いから
- "Vitest Browser Mode" や "Playwright Component Test" は、E2EやJSDOMの統合テストと比べて実行コスト（速さ）はどう違うのか？
  - a
- JSDOM + Vitest + Testing Library React からの置き換えコストは？
- すべて置き換えで良いのか？まだJSDOMが有効なパターンは無いのか？

## JSDOMを推奨しない流れは、世の中的には受け入れられ始めているのか？

**結論**: 既に世の中的にある動きで、フロントエンド開発の最前線にいる開発者たちでは当たり前になりつつある

### 市場データと技術トレンド
- **Playwrightの爆発的普及**: 2025年時点で市場シェア45.1%を獲得
- **InfoQの報道**: ["Vitest Introduces Browser Mode as Alternative to JSDOM"](https://www.infoq.com/news/2025/06/vitest-browser-mode-jsdom/)として大手技術メディアが取り上げ
- **業界の声**: "2024年になってJSDOMとブラウザ環境をシミュレートする必要はもうない"

### 技術リーダーの反応
- **Kent C. Dodds（React Testing Library作者）**: 自身のライブラリからの移行を歓迎するコメント「I have never been so happy to see people uninstalling React Testing Library」
- **Vitest開発チーム**: JSDOM代替としてのBrowser Mode開発を積極推進
- **開発者コミュニティ**: "JSDOMは必要なトレードオフだったが、今はより良いツールがある"

### 具体的な移行事例
- **SingleStore**: ["Our Journey From JSDOM and React Testing Library Toward Cypress Component Testing"](https://www.singlestore.com/blog/our-journey-from-jsdom/)として移行事例を公開
- **Epic Web Dev**: [実ブラウザテストへの移行を推進するワークショップ](https://www.epicweb.dev/workshops/react-component-testing-with-vitest)を開催
- **多数の開発者**: "JSDOM took +9 seconds to parse, used 1G of heap memory"などパフォーマンス問題を報告

### 技術的背景の変化
- **CI/CD環境の改善**: ヘッドレスブラウザの起動コストが大幅削減
- **ツールの成熟**: Playwright/Puppeteerで実ブラウザテストが簡単に
- **デバッグ体験**: 視覚的確認や実際のブラウザデベロッパーツールが使用可能

**参考記事**:
- [Vitest Introduces Browser Mode as Alternative to JSDOM - InfoQ](https://www.infoq.com/news/2025/06/vitest-browser-mode-jsdom/)
- [Our Journey From JSDOM and React Testing Library Toward Cypress Component Testing - SingleStore](https://www.singlestore.com/blog/our-journey-from-jsdom/)
- [Playwright Component Testing: A Modern Alternative to Old Tools - TestOMat](https://testomat.io/blog/playwright-component-testing-as-modern-alternative-to-traditional-tools/)
