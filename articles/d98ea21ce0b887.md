---
title: "JSDOMを使ったIntegration Testが時代遅れかも知れないので調べてみた"
emoji: "🐕"
type: "tech" # tech: 技術記事 / idea: アイデア
topics: []
published: false
publication_name: globis
---

**ネタ元の記事 "Why I Won’t Use JSDOM"**
https://www.epicweb.dev/why-i-won-t-use-jsdom


## ネタ元記事の主張

**メインの批判点：**
1. **JSDOMの根本的問題**: Node.jsで動作し、ブラウザのふりをするが、結果的にどちらでもない中途半端な存在
2. **技術的制限**:
   - 標準ではないイベントを生成し、環境間で一貫性がない
   - グローバルAPIを問題のある方法でパッチする
   - ブラウザのエクスポート条件を強制することで依存関係を不適切に解決

**テスト哲学の問題**:
「テスト環境が実際のコード実行環境に近いほど、テストの価値が高まる」という考えに基づき、JSDOMは実ブラウザ環境から離れすぎている

**推奨される代替案**:
- **Vitest Browser Mode**: 実際のブラウザでテストを直接実行
- Playwrightをブラウザプロバイダーとして使用可能
- より信頼性の高いコンポーネントテストを提供

**結論**: ポリフィルの時代から脱却し、ブラウザ向けコードを実際のブラウザでテストする「パラダイムシフト」を提唱

## 調べる前の仮説

JSDOM自体はまだ非推奨ではないが、Vitest Browser Mode や Playwright Component Test などの実ブラウザを用いたテストが普及したので、それぞれ使い分けることが重要。軽量高速が効果的なユニットテストなどではVitest + JSDOMで高速に。よりユーザー目線の統合テストは Vitest Browser Mode などを用いて実DOMでテストを行う。のが良いのではないだろうか？

まずは主張と実体を調べ、その課題を解決するツールが育っているのか、その課題感は目的に対して妥当なのか？を調べる必要がある。

※仮説を持つことで、成功でも失敗でも、確実に自分の学習を高めることが出来るため、調査前段階の手持ちの知識で当たりをつけておいています。


## 調査中の疑問と解決リスト（執筆中メモ）

- なぜフロントエンドテストにはJSDOMが用いられたのか？
  - E2Eと比較して軽量高速にDOMを模倣したテストを実現したかったから
- なぜ記事では「JSDOMを使わない」と主張しているのか？
  - JSDOMは、node.jsで実行され、ブラウザのふりをするが、結局どちらでも無いから

## JSDOMを推奨しない流れは、世の中的には受け入れられ始めているのか？

**結論**: 既に世の中的にある動きで、フロントエンド開発の最前線にいる開発者たちでは当たり前になりつつある

### 市場データと技術トレンド
- **コンポーネントテスト領域での変化**: Playwright Component TestingやVitest Browser Modeなど、JSDOMの代替となる実ブラウザベースのコンポーネントテストツールが相次いで登場
- **InfoQの報道**: ["Vitest Introduces Browser Mode as Alternative to JSDOM"](https://www.infoq.com/news/2025/06/vitest-browser-mode-jsdom/)として大手技術メディアが取り上げ
- **Epic Web Devの主張**: ["ブラウザ向けUIコンポーネントは実ブラウザでテストすべき。ツールが整った今、それが可能になった"](https://www.epicweb.dev/why-i-won-t-use-jsdom)

### 推進派の反応
- **Vitest開発チーム**: [JSDOM代替としてのBrowser Mode開発を積極推進](https://vitest.dev/guide/browser/)、2025年6月にInfoQでも報道
- **Epic Web Dev**: ["JSDOMは必要なトレードオフだったが、今はより良いツールがある"](https://www.epicweb.dev/why-i-won-t-use-jsdom)
- **開発者コミュニティ**: Testing LibraryのGitHubでも["Render in browser instead of JSDom"](https://github.com/testing-library/dom-testing-library/issues/544)という要望が議論されている

### より慎重な見解・使い分けを主張する意見
- **Kent C. Dodds（React Testing Library作者）**: ["Testing LibraryはJSDOMを直接使用せず、利用可能なDOM環境を使う。パフォーマンス問題はJSDOM（JavaScript実装）が原因で、Testing Libraryのクエリが原因ではない。実ブラウザ（Playwrightなど）でのテスト実行を推奨"](https://x.com/kentcdodds/status/1767305104011444542)（2024年3月）
- **週14百万回のダウンロード**: npm統計によると、JSDOMは最も実績があり信頼性の高い非ブラウザDOMモジュール
- **適切な使い分けの重要性**:
  - **軽量ユニットテスト**: JSDOMは実ブラウザ起動のオーバーヘッドなしで高速
  - **包括的なブラウザAPI**: 複雑なDOM操作、CSS、レイアウトテストに対応
  - **90-99%のケースで十分**: Jest + JSDOMは一般的なテストニーズの大部分をカバー
- **パフォーマンス最適化**: 非UIテストでJSDOMを無効化することで[テスト速度を2倍向上](https://kevinsimper.medium.com/how-to-disable-jsdom-in-jest-make-jest-run-twice-as-fast-a01193f23405)させることが可能

### 具体的な移行事例
- **SingleStore**: ["Our Journey From JSDOM and React Testing Library Toward Cypress Component Testing"](https://www.singlestore.com/blog/our-journey-from-jsdom/)として移行事例を公開
- **Epic Web Dev**: [実ブラウザテストへの移行を推進するワークショップ](https://www.epicweb.dev/workshops/react-component-testing-with-vitest)を開催
- **多数の開発者**: "JSDOM took +9 seconds to parse, used 1G of heap memory"などパフォーマンス問題を報告

### 技術的背景の変化
- **CI/CD環境の改善**: ヘッドレスブラウザの起動コストが大幅削減
- **ツールの成熟**: Playwright/Puppeteerで実ブラウザテストが簡単に
- **デバッグ体験**: 視覚的確認や実際のブラウザデベロッパーツールが使用可能

**参考記事**:
- [Vitest Introduces Browser Mode as Alternative to JSDOM - InfoQ](https://www.infoq.com/news/2025/06/vitest-browser-mode-jsdom/)
- [Our Journey From JSDOM and React Testing Library Toward Cypress Component Testing - SingleStore](https://www.singlestore.com/blog/our-journey-from-jsdom/)
- [Playwright Component Testing: A Modern Alternative to Old Tools - TestOMat](https://testomat.io/blog/playwright-component-testing-as-modern-alternative-to-traditional-tools/)


## 実行速度・置き換えコスト・有効性の調査結果
WIP

### 速度比較の実測データ

**JSDOMの問題**: [LinkedOMの記事](https://webreflection.medium.com/linkedom-a-jsdom-alternative-53dd8f699311)によると、12MBドキュメントでJSDOMが**9秒解析、1GBメモリ使用**。[Material-UI事例](https://github.com/jsdom/jsdom/issues/3659)では**v23.1.0で3分30秒→v23.2.0で7分30秒（×2倍悪化）**。

**Browser Mode vs JSDOM**: [Cheerio vs JSDOM比較](https://www.zenrows.com/blog/jsdom-vs-cheerio)で**JSDOM平均517ms、Cheerio平均300ms**（同一コンテンツ抽出）。

### 移行コストの実例

**SingleStore事例**: [72 RTLテストファイル→2ファイル、70 CCTファイル作成、移行期間5ヶ月](https://www.singlestore.com/blog/our-journey-from-jsdom/)。

**パフォーマンス向上**: [大規模monorepo 6000テスト](https://scottspence.com/posts/testing-with-vitest-browser-svelte-guide)で「クライアントテストはvitest-browser-svelteで超高速実行」。

### JSDOMが有効なパターン

**継続利用**: 基本的DOM操作、高速CI/CD、軽量ユニットテスト。

**Browser Mode必須**: CSS layout、ブラウザAPI、視覚テスト、デバッグ性重視。
