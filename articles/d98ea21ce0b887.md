---
title: "JSDOMを使ったIntegration Testが時代遅れかも知れないので調べてみた"
emoji: "🐕"
type: "tech" # tech: 技術記事 / idea: アイデア
topics: []
published: false
publication_name: globis
---

**ネタ元の記事 "Why I Won’t Use JSDOM"**
https://www.epicweb.dev/why-i-won-t-use-jsdom


## ネタ元記事の主張

**メインの批判点：**
1. **JSDOMの根本的問題**: Node.jsで動作し、ブラウザのふりをするが、結果的にどちらでもない中途半端な存在
2. **技術的制限**:
   - 標準ではないイベントを生成し、環境間で一貫性がない
   - グローバルAPIを問題のある方法でパッチする
   - ブラウザのエクスポート条件を強制することで依存関係を不適切に解決

**テスト哲学の問題**:
「テスト環境が実際のコード実行環境に近いほど、テストの価値が高まる」という考えに基づき、JSDOMは実ブラウザ環境から離れすぎている

**推奨される代替案**:
- **Vitest Browser Mode**: 実際のブラウザでテストを直接実行
- Playwrightをブラウザプロバイダーとして使用可能
- より信頼性の高いコンポーネントテストを提供

**結論**: ポリフィルの時代から脱却し、ブラウザ向けコードを実際のブラウザでテストする「パラダイムシフト」を提唱

## 調べる前の仮説

JSDOM自体はまだ非推奨ではないが、Vitest Browser Mode や Playwright Component Test などの実ブラウザを用いたテストが普及したので、それぞれ使い分けることが重要。軽量高速が効果的なユニットテストなどではVitest + JSDOMで高速に。よりユーザー目線の統合テストは Vitest Browser Mode などを用いて実DOMでテストを行う。のが良いのではないだろうか？

まずは主張と実体を調べ、その課題を解決するツールが育っているのか、その課題感は目的に対して妥当なのか？を調べる必要がある。

※仮説を持つことで、成功でも失敗でも、確実に自分の学習を高めることが出来るため、調査前段階の手持ちの知識で当たりをつけておいています。


## 調査中の疑問と解決リスト（執筆中メモ）

- なぜフロントエンドテストにはJSDOMが用いられたのか？
  - E2Eと比較して軽量高速にDOMを模倣したテストを実現したかったから
- なぜ記事では「JSDOMを使わない」と主張しているのか？
  - JSDOMは、node.jsで実行され、ブラウザのふりをするが、結局どちらでも無いから

## JSDOMを推奨しない流れは、世の中的には受け入れられ始めているのか？

**結論**: 実ブラウザ実行を選ぶ選択肢は増えてきたが、JSDOMも依然として広く使われており状況は移行期にある

### 市場データと技術トレンド
- **コンポーネントテスト領域での変化**: Playwright Component TestingやVitest Browser Modeなど、JSDOMの代替となる実ブラウザベースのコンポーネントテストツールが相次いで登場
- **InfoQの報道**: ["Vitest Introduces Browser Mode as Alternative to JSDOM"](https://www.infoq.com/news/2025/06/vitest-browser-mode-jsdom/)として大手技術メディアが取り上げつつ、当該ブラウザモードがまだ実験段階（experimental）である点も明記
- **Epic Web Devの主張**: ["ブラウザ向けUIコンポーネントは実ブラウザでテストすべき。ツールが整った今、それが可能になった"](https://www.epicweb.dev/why-i-won-t-use-jsdom)

### 推進派の反応
- **Vitest開発チーム**: [JSDOM代替としてのBrowser Mode開発を積極推進](https://vitest.dev/guide/browser/)、2025年6月にInfoQでも報道
- **Epic Web Dev**: ["JSDOMは必要なトレードオフだったが、今はより良いツールがある"](https://www.epicweb.dev/why-i-won-t-use-jsdom)
- **開発者コミュニティ**: Testing LibraryのGitHubでも["Render in browser instead of JSDom"](https://github.com/testing-library/dom-testing-library/issues/544)という要望が議論されている

### より慎重な見解・使い分けを主張する意見
- **Kent C. Dodds（React Testing Library作者）**: ["Testing LibraryはJSDOMを直接使用せず、利用可能なDOM環境を使う。パフォーマンス問題はJSDOM（JavaScript実装）が原因で、Testing Libraryのクエリが原因ではない。実ブラウザ（Playwrightなど）でのテスト実行を推奨"](https://x.com/kentcdodds/status/1767305104011444542)（2024年3月）
- **週3,400万回超のダウンロード**: npm統計（2025年9月15日週）で`jsdom`は3,413万ダウンロードと依然高い利用実績
- **適切な使い分けの重要性**:
  - **軽量ユニットテスト**: JSDOMは実ブラウザ起動のオーバーヘッドなしで高速
  - **包括的なブラウザAPI**: 複雑なDOM操作、CSS、レイアウトテストに対応
  - **多くのケースで十分**: Jest + JSDOMは一般的なテストニーズの大部分をカバーすると報告されている
- **パフォーマンス最適化**: 非UIテストでJSDOMを無効化することで[テスト速度を2倍向上](https://kevinsimper.medium.com/how-to-disable-jsdom-in-jest-make-jest-run-twice-as-fast-a01193f23405)させることが可能

### 具体的な移行事例
- **SingleStore**: ["Our Journey From JSDOM and React Testing Library Toward Cypress Component Testing"](https://www.singlestore.com/blog/our-journey-from-jsdom/)として移行事例を公開
- **Epic Web Dev**: [実ブラウザテストへの移行を推進するワークショップ](https://www.epicweb.dev/workshops/react-component-testing-with-vitest)を開催

### 技術的背景の変化
- **CI/CD環境の改善**: ヘッドレスブラウザの起動コストが大幅削減
- **ツールの成熟**: Playwright/Puppeteerで実ブラウザテストが簡単に
- **デバッグ体験**: 視覚的確認や実際のブラウザデベロッパーツールが使用可能

**参考記事**:
- [Vitest Introduces Browser Mode as Alternative to JSDOM - InfoQ](https://www.infoq.com/news/2025/06/vitest-browser-mode-jsdom/)
- [Our Journey From JSDOM and React Testing Library Toward Cypress Component Testing - SingleStore](https://www.singlestore.com/blog/our-journey-from-jsdom/)
- [Playwright Component Testing: A Modern Alternative to Old Tools - TestOMat](https://testomat.io/blog/playwright-component-testing-as-modern-alternative-to-traditional-tools/)


## JSDOMと実ブラウザのテストの実行時間の差はどの程度あるのか？

### 実測値から見える違い

- **ミニマムケース**では、Zenn記事の検証でVitest Browser Mode 95ms / JSDOM 75ms（約20ms差）という実測値が報告されている。[[Vitest Browser Modeがアツい](https://zenn.dev/apple_yagi/articles/b2b96af1fd355c)]
- **初回起動と反復実行時間**について、株式会社一創の検証ではBrowser Modeの初回起動に5〜10秒のオーバーヘッドが発生し、シンプルなDOM操作でもjsdomより体感で遅くなることが指摘されている。[[Vitest Browser Modeの導入・セットアップ方法を徹底解説](https://www.issoh.co.jp/tech/details/7394/)]
- **大規模スイート**では、Playwright Component TestをChromium/Firefox/WebKit/モバイルChromeで並列実行した事例が約1,200テストを17分（2ブラウザ構成なら10分）で完走し、JSDOMベースより30〜40%遅い一方で許容範囲だったと報告されている。[[Write tests. Not too many. Mostly end-to-end.](https://devsparks.goooseman.dev/hacks/20240615-why-e2e-tests/)]
- **ブラウザ起動に時間がかかるケース**として、Playwrightが13テストでも1分〜1分30秒かかると報告されたGitHub Issueがあり、環境やバージョン差でオーバーヘッドが大きく変動する点に注意が必要だ。[[Playwright issue #22815](https://github.com/microsoft/playwright/issues/22815)]

### CI運用での示唆

- Browser ModeはJSDOMより遅くなる前提で「どのテストを実ブラウザに寄せるか」を決め、軽量ケースはJSDOMに残すハイブリッド運用が推奨される。[[Vitest Browser Modeの導入・セットアップ方法を徹底解説](https://www.issoh.co.jp/tech/details/7394/)]
- Playwright Component Testは30〜40%遅延しつつも、並列化すれば17分で1,200テストを処理できるため、UIクリティカルな経路に絞ったスモークテストとして組み込むとCIの遅延を抑えやすい。[[Write tests. Not too many. Mostly end-to-end.](https://devsparks.goooseman.dev/hacks/20240615-why-e2e-tests/)]
- 初回ダウンロードのオーバーヘッドは避けられないので、Playwright公式が推奨するようにブラウザバイナリのキャッシュ場所を明示しつつ、毎回の`npx playwright install`が走る前提でCI時間を見積もる。[[Playwright公式ドキュメント: Continuous Integration](https://playwright.dev/docs/ci)]


## 今現在 JSDOM + React Testing Library + Vitest の構成で Integration Test が沢山実装してある場合、どうすると良さそうか？

### 仮説: ページ級ハッピーパスをBrowser Modeで補強する

Vitest 3系が提供する`test.projects`を使えば、JSDOMとBrowser Modeを同じリポジトリ内で並行運用できる。プロジェクトごとに`include`グロブを持てるので、`tests/**/*.unit.test.ts`と`tests/**/*.browser.test.ts`のようにファイル名やディレクトリでテストを振り分ければ、JSDOM用とBrowser Mode用をファイル単位で分離できる。公式ガイドはBrowser Modeの仕組みや注意点を整理しているだけなので、軽量テストをJSDOM、高信頼が求められる経路を実ブラウザ、という振り分けは私自身の運用案として書き留めている。

Browser Modeは2025年6月時点でも“experimental”扱いで、ブラウザ起動の初期化オーバーヘッドやPlaywrightなどのプロバイダー設定が運用コストになる。[Vitestの背景解説](https://vitest.dev/guide/browser/why.html?utm_source=openai)や[体験記事](https://zenn.dev/apple_yagi/articles/b2b96af1fd355c?utm_source=openai)でもJSDOMより遅くなる傾向が報告されているため、ページ級ハッピーパスのみに限定することでCI時間の増加を抑えやすい。

一方で実ブラウザはレイアウトやネイティブイベント、ブラウザAPIの差異を捕捉でき、JSDOMでは検出しづらいバグを拾いやすい。[Epic Web Devの記事](https://www.epicweb.dev/why-i-won-t-use-jsdom)や[Playwrightコンポーネントテストの大規模事例](https://devsparks-0-0-0.goooseman.dev/hacks/20240615-why-e2e-tests/?utm_source=openai)が示すように、重要なユーザーフローだけをBrowser Modeへ寄せるハイブリッド運用が信頼性と実行コストのバランスを取りやすいと考えられる。
