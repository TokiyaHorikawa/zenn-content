---
title: "ESLintでガッツリ縛ったプロジェクトへの段階的Biome導入の記録（前篇）"
emoji: "🐿️"
type: "tech" # tech: 技術記事 / idea: アイデア
topics: [typescript, eslint, biome]
published: false
publication_name: globis
---

## 課題

#### 😰 待ち時間が長いと、集中の寸断が発生して効率を落とす

- ESLintをローカルで実行すると1分30秒くらい掛かっていた
- エディタのESLint拡張が重たくなる時がある
- pre-commitが長い

CIは...早いに越したことは無いがテスト系がもっと長いので一旦課題感は小さい

## 目指す状態

#### ESLintとBiomeの併用で良いとこ取り

- 基本のルールはBiomeで縛る（1秒未満を目指す）
- 独自ルールやLibrary推奨のルールはESLintで縛る（5秒以内を目指す）


## 完全置き換えから併用に至るまでの思考過程


### 💡 ESLintをBiomeに置き換えれば速くなるかもしれない！

確かに早い！
0.3秒くらいで recommended のルールなら実行できた(800件くらいエラーを出しつつも)

#### 問題:
  - Biomeは、ESLintのRulesを完全互換できない
  - 独自ルールが作れない
  - testing-libraryやvitestなど、Library推奨の npm package として公開されているrulesが無い

↓
完全互換は多くのルールで縛ったプロジェクトには向かない。。。
じゃあ、Biomeは諦めるか？
↓
いや、Biomeに寄せつつ、ESLintで細かいルールを補えばいいのでは？

### 💡 ESLintを極力削りつつ、Biomeと併用することで「速さ」と「縛り」を両立させられるかもしらない！

概ね併用の考え方で良さそう。

#### 問題:

- ESLintの何を削れば良い？
- 大量のBiomeエラーがでてしまって差分がデカい
- Formatter は Prettier と併用させる？

うん、やることは多そうだ。
🥰 **小さく段階的に導入していこう！**

## Biomeの導入


[Biome公式 Getting Started](https://biomejs.dev/guides/getting-started/)と[Biome公式 Migrate from ESLint & Prettier](https://biomejs.dev/guides/migrate-eslint-prettier/)を参考にしていく。

### 1. Biomeはrootに1つだけ導入する（monorepoの話）

最初にyarn workspace で、それぞれのworkspaceごとにbiomeを導入しようとした。
背景としては、ESLintはworkspaceごとに `.eslintrc.js` で設定を個別で書いていたからそれに合わせた形だった。

```bash
# ⭕️ rootにだけ導入で良さそう
yarn add --dev --exact @biomejs/biome

# ❌️ 当初はworkspaceごとに導入しようとしていた
yarn workspace packageA add --dev --exact @biomejs/biome
yarn workspace packageB add --dev --exact @biomejs/biome
yarn workspace packageC add --dev --exact @biomejs/biome
```

しかし、rootのpackageにだけインストールをするで良さそうだと思った。
もしworkspaceごとに設定を変えたければ、workspace以下に `biome.json` を作成すればいい。
biomeは実行された場所を起点に `biome.json` を探してくれるので、workspaceに `biome.json` が有ればそれを見るし、なければrootの `biome.json` を見に行く。
また、対象と除外の設定が出来るため、影響範囲も指定出来る。

※ 噂によると VSCode などの拡張では root だけを読みに行くらしい？また workspace 拡張で開いた場合はどうなるのだろう？

[Biome公式 Big Projects](https://biomejs.dev/guides/big-projects/)
[Biome の導入と設定方法まとめ - 設定と振る舞い](https://zenn.dev/akineko/articles/d967d5dcada598#%E8%A8%AD%E5%AE%9A%E3%81%A8%E6%8C%AF%E3%82%8B%E8%88%9E%E3%81%84)

## ESLintの実行時間の長いルールを削る

## 互換性のあるBiomeのルールを適用する

## ESLintのルールを本当に必要なものだけに減らす
